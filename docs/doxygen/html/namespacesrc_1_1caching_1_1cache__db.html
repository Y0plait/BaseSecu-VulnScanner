<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VisualNet Scanner: src.caching.cache_db Namespace Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">VisualNet Scanner<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">Comprehensive vulnerability scanner for Linux machines with network visualization</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('namespacesrc_1_1caching_1_1cache__db.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">src.caching.cache_db Namespace Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a0e48e0f6b8aeaa05336e70eccbb79e9e" id="r_a0e48e0f6b8aeaa05336e70eccbb79e9e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0e48e0f6b8aeaa05336e70eccbb79e9e">sync_modified_cves</a> (api_key=None)</td></tr>
<tr class="memitem:af5c6d2e883205f45d0141ac591a8be70" id="r_af5c6d2e883205f45d0141ac591a8be70"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af5c6d2e883205f45d0141ac591a8be70">get_db</a> ()</td></tr>
<tr class="memitem:a7e907f1dd60da7d4bf76bed957b011fb" id="r_a7e907f1dd60da7d4bf76bed957b011fb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7e907f1dd60da7d4bf76bed957b011fb">get_vulnerabilities</a> (cpe_string, api_key=None)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ac59869222c118a2e9c90ea5b088fe99d" id="r_ac59869222c118a2e9c90ea5b088fe99d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac59869222c118a2e9c90ea5b088fe99d">logger</a> = logging.getLogger(__name__)</td></tr>
<tr class="memitem:a87b78d57b243fab68ec15b7d862ccab5" id="r_a87b78d57b243fab68ec15b7d862ccab5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a87b78d57b243fab68ec15b7d862ccab5">VULN_DB_PATH</a> = os.path.join(CACHE_DIR, &quot;vulnerability_cache.db&quot;)</td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">@file cache_db.py
@brief NVD vulnerability database caching and management module

Implements local SQLite caching for National Vulnerability Database (NVD) CVE data.
Uses a cache-first strategy with nvdlib to minimize API calls and improve performance.

Database Schema:
- cpe_index: Tracks which CPEs have been queried (cpe_string, last_fetched timestamp)
- vulnerabilities: Stores CVE results (cpe_string, cve_id, description)

@author Anton Moulin
@date 2025-12-24
@version 1.0

@details
The module follows this strategy:
1. Before querying NVD API, check if CPE exists in local cache
2. If found, return cached results immediately
3. If not found, query NVD API via nvdlib library
4. Store results in SQLite database for future queries
5. Optional: sync_modified_cves() updates cached entries with latest NVD data

NVD API Rate Limiting:
- With API key: 50 requests per 30 seconds (0.6s delay between requests)
- All queries are rate-limited at vulnerability_checker.py level
- Cache avoids redundant API calls for frequently checked packages
</pre> </div><a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="af5c6d2e883205f45d0141ac591a8be70" name="af5c6d2e883205f45d0141ac591a8be70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5c6d2e883205f45d0141ac591a8be70">&#9670;&#160;</a></span>get_db()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">src.caching.cache_db.get_db </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Initialize and return SQLite database connection with required schema.

@return sqlite3.Connection Database connection object with tables created

@details
Creates two tables if they don't exist:

**cpe_index table:**
- cpe_string TEXT PRIMARY KEY: The CPE to identify
- last_fetched TIMESTAMP: When this CPE was last queried from NVD
Used to track which CPEs have been searched and detect cache misses.

**vulnerabilities table:**
- cpe_string TEXT: Foreign key to cpe_index
- cve_id TEXT: CVE identifier (e.g., "CVE-2024-1234")
- description TEXT: Vulnerability description from NVD
- published_date TEXT: CVE publication date from NVD
Stores actual CVE data for cached CPEs.

Schema design allows:
- Fast lookup of cached CPEs (indexed on cpe_string)
- Multiple CVEs per CPE (one-to-many relationship)
- Quick retrieval of all vulnerabilities for a CPE

Database file location: db/vulnerability_cache.db
</pre> 
<p class="definition">Definition at line <a class="el" href="cache__db_8py_source.html#l00079">79</a> of file <a class="el" href="cache__db_8py_source.html">cache_db.py</a>.</p>

</div>
</div>
<a id="a7e907f1dd60da7d4bf76bed957b011fb" name="a7e907f1dd60da7d4bf76bed957b011fb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e907f1dd60da7d4bf76bed957b011fb">&#9670;&#160;</a></span>get_vulnerabilities()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">src.caching.cache_db.get_vulnerabilities </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>cpe_string</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>api_key</em></span><span class="paramdefsep"> = </span><span class="paramdefval">None</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Retrieve vulnerabilities for a CPE using cache-first strategy.

@param cpe_string str CPE identifier (e.g., "cpe:2.3:a:vendor:product:version:...")
@param api_key str NVD API key for higher rate limits (optional)

@return list List of (cve_id, description) tuples for the CPE

@details
**Cache-first lookup algorithm:**
1. Check if CPE exists in local cpe_index table
2. If found (cache hit):
   - Retrieve and return cached vulnerability data
   - Timestamp shows when data was last fetched
3. If not found (cache miss):
   - Query NVD API via nvdlib.searchCVE()
   - Insert CPE into cpe_index with current timestamp
   - Insert all returned CVEs into vulnerabilities table
   - Return the CVE data

This approach:
- Minimizes NVD API calls (crucial for rate limiting)
- Provides instant results for frequently checked packages
- Automatically caches new packages on first query
- Rate limiting is handled by vulnerability_checker.py (0.6s delay)

The nvdlib library handles:
- HTTP connection to NVD
- Parsing JSON responses
- Rate limit exceptions (429, 503, etc)

@note
Caller should implement rate limiting between calls to respect
50 requests/30 seconds NVD API limit (with key).
</pre> 
<p class="definition">Definition at line <a class="el" href="cache__db_8py_source.html#l00132">132</a> of file <a class="el" href="cache__db_8py_source.html">cache_db.py</a>.</p>

</div>
</div>
<a id="a0e48e0f6b8aeaa05336e70eccbb79e9e" name="a0e48e0f6b8aeaa05336e70eccbb79e9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e48e0f6b8aeaa05336e70eccbb79e9e">&#9670;&#160;</a></span>sync_modified_cves()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">src.caching.cache_db.sync_modified_cves </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>api_key</em></span><span class="paramdefsep"> = </span><span class="paramdefval">None</span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Update cached CVE entries with latest information from NVD.

@param api_key str NVD API key for higher rate limits (optional)

@details
Queries NVD for any CVEs modified in the last 24 hours and updates
local database entries. Useful for periodic maintenance to keep cache fresh.

Does not check all CPEs, only looks for globally modified CVEs.
This is less efficient than selective updates but works without CPE list.
</pre> 
<p class="definition">Definition at line <a class="el" href="cache__db_8py_source.html#l00046">46</a> of file <a class="el" href="cache__db_8py_source.html">cache_db.py</a>.</p>

</div>
</div>
<a name="doc-var-members" id="doc-var-members"></a><h2 id="header-doc-var-members" class="groupheader">Variable Documentation</h2>
<a id="ac59869222c118a2e9c90ea5b088fe99d" name="ac59869222c118a2e9c90ea5b088fe99d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac59869222c118a2e9c90ea5b088fe99d">&#9670;&#160;</a></span>logger</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">src.caching.cache_db.logger = logging.getLogger(__name__)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cache__db_8py_source.html#l00037">37</a> of file <a class="el" href="cache__db_8py_source.html">cache_db.py</a>.</p>

</div>
</div>
<a id="a87b78d57b243fab68ec15b7d862ccab5" name="a87b78d57b243fab68ec15b7d862ccab5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a87b78d57b243fab68ec15b7d862ccab5">&#9670;&#160;</a></span>VULN_DB_PATH</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">src.caching.cache_db.VULN_DB_PATH = os.path.join(CACHE_DIR, &quot;vulnerability_cache.db&quot;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="cache__db_8py_source.html#l00043">43</a> of file <a class="el" href="cache__db_8py_source.html">cache_db.py</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="namespacesrc.html">src</a></li><li class="navelem"><a href="namespacesrc_1_1caching.html">caching</a></li><li class="navelem"><a href="namespacesrc_1_1caching_1_1cache__db.html">cache_db</a></li>
    <li class="footer">Generated on <span class="timestamp"></span> for VisualNet Scanner by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
